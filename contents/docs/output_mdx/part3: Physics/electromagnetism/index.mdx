# Electrical Circuits \{#chap:electric_circuits\}

------------------------------------------------------------------------

\
**Prerequisites:**
[\[chap:electric_current\]](#chap:electric_current)\{reference-type="ref+label"
reference="chap:electric_current"\},\
**Difficulty Level:** \*\

------------------------------------------------------------------------

An electrical circuit consists of individual electronic components such
as resistors, capacitors, inductors, transistors and diode connected by
conducting wires. Electrical circuits can be used to compute various
functions on demand. This functionality means that electric circuits are
tremendously useful for real physical devices.

In this chapter, we introduce you to the basics components of electrical
circuits and provide you with some mathematical tools to model them.
We'll study both direct current and alternating current circuits as we
make our tour.

## Basics of Circuits

An electrical circuit is a mathematical abstraction of a real system
with sources of electrical power (say a battery or other source) and
various \"circuit elements\" which transform the input electrical power
in various ways. Figure
[1.1](#fig:circuit_diagram_and_schematic)\{reference-type="ref"
reference="fig:circuit_diagram_and_schematic"\} demonstrates a drawing of
a real circuit and its associated diagram.

<figure id="fig:circuit_diagram_and_schematic">
<p><img
src="figures/Physics/electromagnetism/electrical_circuits/Real_Electrical_Circuit_1.png"
style="width:70.0%" alt="image" /> <img
src="figures/Physics/electromagnetism/electrical_circuits/Real_Electrical_Circuit_2.png"
style="width:70.0%" alt="image" /></p>
<figcaption>Example of a real electrical circuit and its diagrammatic
representation. </figcaption>
</figure>

Working with a diagrammatic abstraction of a circuit brings powerful
advantages. Electrical engineers have developed a series of mathematical
abstractions that will allow us to transform a given circuit into a set
of equations which can be solved. As we will see later in this chapter,
this same set of equations can be easily transformed into differentiable
programs for modelling circuits.

### Basic Circuit Concepts

We first need to introduce the basic physical concepts underpinning
circuits. To start, we will stick to direct-current (DC) circuits in
which the voltage does not vary or oscillate with time. Each current
must have a voltage source which provides a fixed voltage difference
$V$. The voltage difference will induce electrical charges to move and
create an electrical current. We will refer to charge as $Q$ and current
as $I$.

Resistors are a basic circuit element. Roughly put, a resistor is a
region of the circuit where current can't freely flow. You can think of
a resistor as an insulating element stuck into a circuit. Current can
cross a resistive region, but at the cost of some energy. The
fundamental equation which models a resistor is given by Ohm's law.

## Ohm's Law

Suppose we have a circuit with a given resistor with resistance $R$.
Then the voltage difference across the resistor $V$ is proportional to
the product of the current $I$ moving across the resistor and the
resistance. $$V = IR$$

Let's turn this into a simple differentiable program.

    Voltage, Current, Resistance : $\mathbb\{R\}$
    def ohms(I: Current, R: Resistance) -> Voltage:
      return I * R

The next basic circuit element is the capacitor, which stores electric
energy in the electric field. The capacitor has two separated plates. As
charge $Q$ flows, a voltage difference $V$ builds up across the plates.
The defining equation of a capacitor is given by

$$\begin\{aligned\}
C = \frac\{Q\}\{V\}
\end\{aligned\}$$

where $C$ is a quantity known as the capacitance.

Inductors are similar to capacitors but store energy in a magnetic field
rather than in the electric field. The defining equation of an inductor
is given by

$$\begin\{aligned\}
\Phi &= LI
\end\{aligned\}$$ where $L$ is a quantity called the inductance.

### Alternating Current Circuits

Many real world systems have alternating current sources. Here, the
voltage in the system is given by some time varying source $V(t)$. The
current then becomes a time varying function $I(t)$ as well.

Impedence is the opposition a circuit presents to current when voltage
is applied. The impedence is a complex number typically represented as
$Z$. The impedence will prove a crucial quantity to analyze the behavior
of an alternating current. Let's analyze the impedence of a simple
alternating current circuit. We write the current as $$\begin\{aligned\}
I(t)  &= |I|e^\{j(\omega t + \phi_I)\}
\end\{aligned\}$$ We write the voltage similarly as $$\begin\{aligned\}
V(t) &= |V|e^\{j(\omega t + \phi_V)\}
\end\{aligned\}$$ The impedence is defined as the ratio of voltage to
current $$\begin\{aligned\}
Z &= \frac\{V\}\{I\} \\
&= \frac\{|V|\}\{|I|\}e^\{j(\phi_V-\phi_I)\}
\end\{aligned\}$$ Note that $Z$ does not vary in time. We can use these
definitions to compute the impedence for resistors, capacitors, and
inductors to be $$\begin\{aligned\}
    Z_R &= R\\ 
    Z_C &= \frac\{1\}\{j\omega C\} \\
    Z_L &= j\omega L
\end\{aligned\}$$

## Transfer Functions

For a continuous time input signal $x(t)$ and output signal $y(t)$, the
transfer function $H(s)$ is the ratio of the Laplace transforms of the
output and the input $$\begin\{aligned\}
    H(s) = \frac\{\mathcal\{L\}\{y(t)\}(s)\}\{\mathcal\{L\}\{x(t)\}(s)\}
\end\{aligned\}$$ where $\mathcal\{L\}$ here denotes the Laplace transform
and not a loss function. We write $s = \sigma + j\omega$ as a complex
variable as the Laplace transformed variable. The transfer function
proves a powerful tool to consider complex circuits with chained
transformations.

## Analyzing Circuits

Mathematically analyzing a circuit can become complex quickly. In this
section, we review a few standard methods for circuit analysis.

### Kirchhoff's Laws

Kirchoff's laws provide standard rules for transforming an electrical
circuit into a system of equations.

Kirchhoff's Circuit Law states that for any junction in an electrical
circuit, the current entering the junction is equal to the current
leaving the junction. Kirchhoff's Voltage Law states that the sum of the
voltages around a closed loop is zero.

These two laws can be used to analyze complex circuits and transform
them into equations which can be solved analytically and
programmatically.

### RC Circuit

Let's consider a simple resistor-capacitor circuit as in Figure
[\[rc_simple\]](#rc_simple)\{reference-type="ref" reference="rc_simple"\}.

$$C \frac\{dV\}\{dt\} + \frac\{V\}\{R\} = 0$$ where $C$ is the capacitance of
the circuit and $V$ is the voltage across it. Let's solve this equation
$$\begin\{aligned\}
    C \frac\{dV\}\{dt\} + \frac\{V\}\{R\} &= 0 \\
    -\frac\{1\}\{V\} \frac\{dV\}\{dt\} &= \frac\{1\}\{RC\} \\
    - \int \frac\{1\}\{V\} \frac\{dV\}\{dt\} dt &= \frac\{T\}\{RC\} \\
    - \ln(V) - \ln(V_0) &= \frac\{T\}\{RC\} \\
    V &= V_0 e^\{-\frac\{CT\}\{R\}\}
\end\{aligned\}$$

Note how the voltage held in the capacitor dissipates over time.

::: marginfigure
![image](figures/Physics/electromagnetism/electrical_circuits/Simple_RC.png)\{width="\\textwidth"\}
:::

::: marginfigure
![image](figures/Physics/electromagnetism/electrical_circuits/RC Circuit.png)\{width="\\textwidth"\}
:::


# Electric Current and the Magnetic Field \{#chap:electric_current\}

------------------------------------------------------------------------

\
**Prerequisites:**
[\[chap:electrostatics\]](#chap:electrostatics)\{reference-type="ref+label"
reference="chap:electrostatics"\},\
**Difficulty Level:** \*\

------------------------------------------------------------------------

In
[\[chap:electrostatics\]](#chap:electrostatics)\{reference-type="ref+label"
reference="chap:electrostatics"\}, we learned about the behavior of
systems of point charges. In the real world, it's more common to deal
with flowing electric charges or electric currents. In this chapter we
introduce the mathematical and computational models used to study
electric current. We also introduce the notion of the magnetic field, a
powerful abstraction useful for the study of complex electric systems.
Magnetic fields are associated with electric currents much as electric
fields are associated with static electrical charges.

## Electric Current

Let's define electric current more formally. We say that the electric
current is the rate of flow of electric charge past a point or a region.
The mathematical symbols used to define electrical current are usually
either $I$ or $J$. Suppose that charge $Q$ flows through a given region
of space in time $t$. We can then define $$\begin\{aligned\}
    I = \frac\{Q\}\{t\}
\end\{aligned\}$$

As the time $t$ goes to $0$, we can replace this definition with a
suitable limit $$\begin\{aligned\}
    I = \frac\{dQ\}\{dt\}
\end\{aligned\}$$ We can define types for these quantities

    Q : Ampere, t: sec, I: Ampere/sec

Recall that `Ampere` is the same type as $\mathbb\{R\}$ and `sec` is the
same type as $\mathbb\{R\}^+$. Since $Q \in \mathbb\{R\}$ is a real valued
quantity, and $t \in \mathbb\{R\}^+$ is a nonnegative quantity, we can say
that $I \in \mathbb\{R\}$ is also a real valued quantity.

::: marginfigure
![image](figures/Physics/electromagnetism/electric_current/Electric current.png)\{width="\\textwidth"\}
:::

## Lorentz Force Law

Empirically, Coulomb's law isn't a complete description of the physics
moving electrical particles since it ignores magnetism. Consequently, we
introduce a new law, the *Lorentz force law*. Let $\vec\{E\}(t)$ be the
electric field and let $\vec\{B\}(t)$ be the magnetic field. A particle
with charge $q$ moving with velocity $\vec\{v\}$ experiences a force given
by $$\begin\{aligned\}
    \vec\{F\} = q(E + v \times B)
    \label\{lorentz:force\}
\end\{aligned\}$$

We've introduced a new concept in this definition, that of the magnetic
field $\vec\{B\}$. What is the magnetic field? To give a more
sophisticated derivation of the magnetic field, we will need to wait
until the section on special relativity. For now, it's not wrong to view
Equation [\[lorentz:force\]](#lorentz:force)\{reference-type="ref"
reference="lorentz:force"\} as *defining* the magnetic field. That is,
the magnetic field can be viewed as an empirical correction term that
fixes Coulomb's law to work for electrodynamical systems. The magnetic
field is a field much like the classical field and has a similar type

    B: $\mathbb\{R\}^3 \to T\mathbb\{R\}^3$

### A charged particle in a magnetic field

In this simple example, we consider a charged particle moving in a
magnetic field as illustrated in
Figure [1.1](#fig:charged_particle_magnetic_field)\{reference-type="ref"
reference="fig:charged_particle_magnetic_field"\}.

![A charged particle in a magnetic field.
](figures/Physics/electromagnetism/electric_current/Charged Particle in mag field.png)\{#fig:charged_particle_magnetic_field
width="\\linewidth"\}

Let's introduce a coordinate basis of orthonormal vectors for this
example. We are working in $\mathbb\{R\}^3$ and we have vectors
$\hat\{i\}, \hat\{j\}, \hat\{k\}$. We choose this basis such that
$\hat\{i\} \times \hat\{j\} = \hat\{k\}$. Let's say that the
$\vec\{v_0\} = \hat\{i\}$ and $\vec\{B\} = \hat\{j\}$ everyone in
$\mathbb\{R\}^3$. The states of the system are $$\begin\{aligned\}
\mathcal\{S\} = \mathbb\{R\}^3 \times \mathbb\{R\}^3 \times \mathbb\{R\}^3  
\end\{aligned\}$$ Each state consists of a tuple
$(\vec\{x\}, \vec\{v\}, \vec\{a\})$ of position, velocity, and acceleration
for the charged particle. We define force $F$ by $$\begin\{aligned\}
F(x) = q(\vec\{v\} \times \vec\{B\}) 
\end\{aligned\}$$

Using the known value of $\vec\{v_0\}$, we can compute $$\begin\{aligned\}
\vec\{F_0\} &= q (\vec\{v_0\} \times \vec\{B\}) \\
&= q \|\vec\{v_0\}\| \|\vec\{B\}\|(\hat\{i\} \times \hat\{j\}) \\
&= q\|\vec\{v_0\}\| \|\vec\{B\}\|\hat\{k\}
\end\{aligned\}$$

For the domain of applicability, we limit the velocity to
non-relativistic speeds $\|\vec\{v\}\| < C$.

The parameters of the system are $$\begin\{aligned\}
\mathcal\{W\} = \{q, \vec\{B\}, \vec\{v_0\}\}
\end\{aligned\}$$ where $q$ is the charge of the particle, $\vec\{B\}$ is
the constant magnetic field, and $\vec\{v_0\}$ is the initial velocity.
The hyperparameters are given by $\mathcal\{H\} = \{C\}$.

Note that the initial force $\vec\{F_0\}$ we computed points perpendicular
to the motion of the particle. This is exactly the force needed to
induce circular motion. Note that this motion will ensure that the
charged particle is always perpendicular to the magnetic field so this
circle will close in on itself.

We can solve for the radius of the circle using the definition of
centripetal force. $$\begin\{aligned\}
    q\|\vec\{v_0\}\|\|\vec\{B\}\| &= \frac\{m\|v_0\|^2\}\{R\} \\
    R &= \frac\{m\|v_0\|\}\{q\|\vec\{B\}\|\}
\end\{aligned\}$$

## Ampère's Law

Where does the magnetic field come from? The rough idea is that magnetic
fields are induced by movement of electric charge. Let's introduce one
more law to formalize this, *Ampère's Law*. This law states that the
line integral of the magnetic field $\vec\{B\}$ around a close path is a
multiple of the current enclosed by the path.
$$\oint_C \vec\{B\} \dot d\vec\{s\} = \mu_0 I_\{\textrm\{encl\}\}$$

![A curve enclosing a wire with current.
](figures/Physics/electromagnetism/electric_current/Current in curve.png)\{#fig:current:in:curve
width="80%"\}


# Laplace's Equation and Poisson's Equation \{#chap:greens_laplace\}

------------------------------------------------------------------------

\
**Prerequisites:**
[\[chap:electrostatics\]](#chap:electrostatics)\{reference-type="ref+label"
reference="chap:electrostatics"\},
[\[chap:electric_current\]](#chap:electric_current)\{reference-type="ref+label"
reference="chap:electric_current"\}\
**Difficulty Level:** \*\*\

------------------------------------------------------------------------

Laplace's equation is given by $$\begin\{aligned\}
\nabla^2 f &= 0
\end\{aligned\}$$ In the case that the boundary condition is given by some
function $h$, we have Poisson's equation $$\begin\{aligned\}
\nabla^2 f &= h
\end\{aligned\}$$ Poisson's equation arises in electrostatic systems in
the following manner. Let $V$ denote the electric potential. Suppose
that we have some charge density $\rho$. Then the following equation
holds true

$$\begin\{aligned\}
\nabla^2 V &= -\frac\{\rho\}\{\varepsilon_0\}
\end\{aligned\}$$

In general, we assume that $\rho$ is a known function and we face the
problem of recovering $V$.

## Green's Function Methods

Green's functions provide a powerful tool for solving Laplace's
equations and Poisson's equations. We seek a function $G$ which
satisfies the property

$$\begin\{aligned\}
\nabla^2 G(x, x') =  \delta(x-x') 
\end\{aligned\}$$ We claim that this Green's function is given by
$$\begin\{aligned\}
G(x, x') &= -\frac\{1\}\{4\pi\} \frac\{1\}\{|x - x'|\}
\end\{aligned\}$$

Then the solution $V$ for an arbitrary charge potential $\rho$ is given
by $$\begin\{aligned\}
V(x) &= \int_\{x'\} G(x, x') \rho(x') dx'
\end\{aligned\}$$ In principle this allows for the solution of arbitrary
Poisson's equation problems. In practice, the integral may be
challenging to compute. However, we see that this is an integral
program, so we may use numerical integration to obtain a numerical
solution.


# Method of Images \{#chap:method_of_images\}

------------------------------------------------------------------------

\
**Prerequisites:**
[\[chap:electrostatics\]](#chap:electrostatics)\{reference-type="ref+label"
reference="chap:electrostatics"\},\
**Difficulty Level:** \*\*\

------------------------------------------------------------------------

The method of images is a technique for solving differential equations
by extending the domain of the sought function to a larger domain with
simpler boundary conditions. This technique is applied most often in
physics to problems in electrostatics.

## Point Charge Above Infinite Plane

Consider a point above an infinite conducting plane as in
Figure [1.1](#fig:point_charge_plane)\{reference-type="ref"
reference="fig:point_charge_plane"\}. A challenge with solving for the
electric field in this scenario is that the point charge induces changes
in the charge distribution on the conducting plane.

The method of images provides a powerful trick for solving such systems.
We leverage the fact that solutions to Laplace's equations are unique to
construct a \"mirror\" system that satisfies the same boundary
conditions at the plane as our original system. We claim that the system
in Figure [1.2](#fig:point_charge_mirrored)\{reference-type="ref"
reference="fig:point_charge_mirrored"\} satisfies the same conditions.

![A point charge above an infinite conducting ground.
](figures/Physics/electromagnetism/method_of_images/point_above_sheet.png)\{#fig:point_charge_plane\}

![A point charge mirrored by an opposite charge below the plane.
](figures/Physics/electromagnetism/method_of_images/point_mirrored.png)\{#fig:point_charge_mirrored\}

## Point Charge Near a Conducting Sphere

As a next example, we consider a system with a charge near a grounded
conducting sphere as in
Figure [1.3](#fig:point_sphere)\{reference-type="ref"
reference="fig:point_sphere"\}. Unlike the flat plane, the mirror charge
placed inside the sphere will not be directly symmetrically positioned
to the exterior charge, but the same organizing principle holds.

![A point charge near a conducting sphere.
](figures/Physics/electromagnetism/method_of_images/point_sphere.png)\{#fig:point_sphere\}


# Electrostatics and the Electric Field \{#chap:electrostatics\}

------------------------------------------------------------------------

\
**Prerequisites:**
[\[chap:newtons_laws\]](#chap:newtons_laws)\{reference-type="ref+label"
reference="chap:newtons_laws"\},\
**Difficulty Level:** \*\

------------------------------------------------------------------------

In this chapter we introduce the basics of electrostatics, the study of
charged particles at rest. We also introduce the important notion of the
electric field, a powerful abstraction which will enable us to reason
more effectively about systems of charged particles.

## A Point Particle

The starting point of electromagnetism is the idea of \"charge.\" Charge
is a property of certain types of matter and can be positive, negative,
or zero, and the presence of charge induces a concomitant force.
*Coulomb's law* provides the fundamental equation governing charged
systems. Suppose we have two charged particles with charges $q_1$ and
$q_2$ at distance $r$ from one another. These charges exert a force on
one other with magnitude $$\begin\{aligned\}
    \|\vec\{F\} \| = \frac\{1\}\{4 \pi \epsilon_0\} \frac\{q_1q_2\}\{r^2\}
    \label\{eqn:coulomb_law\}
\end\{aligned\}$$ where $\epsilon_0$ is a physical constant. This force is
attractive if the forces have the same charge or repulsive otherwise.
You might note here that this law has the same rough form as Newton's
gravitational law.

Let us suppose that charges $q_1$ and $q_2$ are at positions
$\vec\{x\}_1, \vec\{x_2\}$ and write down the force that is exerted on $q_2$
explicitly

$$\begin\{aligned\}
\vec\{F\}_\{12\} = \frac\{1\}\{4 \pi \epsilon_0\} \frac\{q_1q_2\}\{\|\vec\{x_1\} - \vec\{x_2\}\|\} \frac\{\vec\{x_2\}-\vec\{x_1\}\}\{\|\vec\{x_1\} - \vec\{x_2\}\|\}
\end\{aligned\}$$

Note that $\vec\{F\}_\{12\}$ has type $\mathbb\{R\}^3$. Here is a simple
differentiable program that implements this force calculation
explicitly.

``` \{.python language="python"\}
$\epsilon_0$: $\mathbb\{R\}$ # Constant
def coulomb(q1: $\mathbb\{R\}$, q2: $\mathbb\{R\}$, x1: $\mathbb\{R\}^3$, x2: $\mathbb\{R\}^3$) -> $(\mathbb\{R\}^3, \mathbb\{R\}^3)$:
  Fmag = (1 / (4 * $\pi$ * $\epsilon_0$)) * (q1 * q2 / $\| \textrm\{x1\} - \textrm\{x2\} \|^2$))
  return (Fmag * (x2 - x1)/$\| \textrm\{x1\} - \textrm\{x2\} \|$, Fmag * (x1 - x2)/$\| \textrm\{x1\} - \textrm\{x2\} \|$)
```

This program computes the forces on both $q_1$ and $q_2$ and returns
them both. Since the type of a force is $\mathbb\{R\}^3$, the return type
we get here is a tuple $(\mathbb\{R\}^3, \mathbb\{R\}^3)$. Read through this
function and make sure you can convince yourself this is a faithful
implementation of Coulomb's law. Note that one advantage of this
formulation is that $\epsilon_0$ is now a free parameter that can be
learned from data.

Suppose that we have one charge $q_1$ at a position $x_1$ in space.
Let's suppose that have another charge $q_2$ elsewhere in space. Note
that we can write the force equation with $q_2$ factored out as

$$\begin\{aligned\}
    \vec\{F\}_\{12\} = \left (\frac\{1\}\{4 \pi \epsilon_0\} \frac\{q_1\}\{\|\vec\{x_1\} - \vec\{x_2\}\|^2\} \frac\{\vec\{x_2\}-\vec\{x_1\}\}\{\|\vec\{x_1\} - \vec\{x_2\}\|\} \right) q_2
\end\{aligned\}$$

Note that the quantity in parentheses only depends on the location in
space $\vec\{x_2\}$. It's common to denote this quantity as the electric
field $\vec\{E\}$.

$$\begin\{aligned\}
    \vec\{E\}(\vec\{x\}) &= \frac\{1\}\{4 \pi \epsilon_0\} \frac\{q_1\}\{\|\vec\{x_1\} - \vec\{x_2\}\|^2\} \frac\{\vec\{x\}-\vec\{x_1\}\}\{\|\vec\{x\} - \vec\{x_2\}\|\} 
\end\{aligned\}$$

The electric field $\vec\{E\}$ is a function that assigns to every point
in space a vectorial quantity. Given this definition, we can simplify
our earlier force definition as $$\begin\{aligned\}
    \vec\{F\}_\{12\} &= \vec\{E\}(x_2) q_2
\end\{aligned\}$$

The type of the electric field is given by

    $\vec\{E\}$ : $\mathbb\{R\}^3 \to \mathbb\{R\}^3$

That is, the electric field is naturally a function type. It's the first
basic physical quantity we've defined that naturally has this type.
Mathematically, we can also say that the electric field is a vector
field and alternatively write its type as

    $\vec\{E\}$ : $\mathbb\{R\}^3 \to \mathrm\{T\} \mathbb\{R\}^3$

These two types are identical since the tangent space of $\mathbb\{R\}^3$
can be identified with $\mathbb\{R\}^3$. We can define a simple
differentiable program to compute the electric field of a point particle
as follows.

    def E(q1: $\mathbb\{R\}$, x1: $\mathbb\{R\}^3$, x: $\mathbb\{R\}^3$) -> $\mathbb\{R\}^3$:
      ((1 / (4 * $\pi$ * $\epsilon_0$)) * (q1 * q2 / $\| \textrm\{x\} - \textrm\{x1\} \|^2$)) 
               * (x - x1)/$\| \textrm\{x\} - \textrm\{x1\} \|$)

Oftentimes it's natural to think about the electric field as the more
basic object than any explicit force. The reason is that given the
electric field, we can compute forces for many different choices of
other point charges.

How can we measure the electric field due to a point particle? We
suppose that we have a small charge $dq$ at $x'$ whose charge is known
(we choose a small charge so the reciprocal force on $q$ is negligible).
Suppose also that we can measure the force $\vec\{F\}$ on $dq$ directly,
but with Gaussian error that has bias $b \in \mathbb\{R\}^3$ and some
standard deviation $\sigma$. That is we measure $$\begin\{aligned\}
\vec\{F\}_\{dq\}(x') + \mathcal\{N\}(b, \sigma^2)
\end\{aligned\}$$ If we divide through by $dq$, we then obtain the
following approximate error for the electric field (remember the scaling
rule for Normal distributions is that multiplying by a constant scales
the variance by the constant squared)

$$\begin\{aligned\}
    \vec\{E\}(x') + \mathcal\{N\}\left (b, \frac\{\sigma^2\}\{dq^2\} \right)
\end\{aligned\}$$

Let's write down a differentiable program that samples a measurement of
the electric field for a given point particle $q$ at
$x \in \mathbb\{R\}^3$

    def measure(q: $\mathbb\{R\}$, dq: $\mathbb\{R\}$, x: $\mathbb\{R\}^3$, x': $\mathbb\{R\}^3$, b: $\mathbb\{R\}^3$, $\sigma$: $\mathbb\{R\}^3$) -> $\mathbb\{R\}^3$:
      return E($\epsilon_0$, q, x, x') + Normal(b, $\sigma^2$/$\textrm\{dq\}^2$)

Let's suppose that we now have a dataset of experimental measurements of
the field generated by a charge $q$ at $x \in \mathbb\{R\}^3$. Suppose
that our test charge is $dq$ and we've measured at $x_1, \dotsc, x_n$
and obtained experimental field measurements $E_1, \dotsc, E_n$. Let's
see how we could then learn the value of parameter $\epsilon_0$ from
this dataset. Let's first write down a model for the generation of the
experimental dataset.

    def gen(N: $\mathbb\{N\}$, q: $\mathbb\{R\}$, $dq$: $\mathbb\{R\}$, $x$: $\mathbb\{R\}^3$, [$x_i$]: $\mathbb\{R\}^\{3n\}$, b:$\mathbb\{R\}^3$, $\sigma$: $\mathbb\{R\}^3$) -> $\mathbb\{R\}^\{3n\}$:
      return [measurement(q, dq, x, xi, b, $\sigma)$ for xi in [$x_i$]]

Let's suppose that we know $b, \sigma$ for simplicity. Then we can write

    $\overline\{\epsilon_0\}$ = Optimize(gen, [$E_i$], $\epsilon_0$)

We have successfully taken the physical theory and transformed it into a
simple effective computation for learning basic physical constants like
$\epsilon_0$ from experimental measurements.

## Electrostatic Potential Energy

In this section, we introduce a notion of potential energy for point
charges. The *electrostatic potential energy* of a point charge with
charge $q$ at distance $r$ from another point charge with charge $Q$ is
given by $$U(r) = \frac\{1\}\{4\pi \epsilon_0\} \frac\{qQ\}\{r\}$$ The type of
$U$ is given by

    U: $\mathbb\{R\}^+ \to \mathbb\{R\}$

The basic idea here is the same as that for gravitational potential
energy. The potential energy difference between two points tracks the
work that is needed to move between them. Recall that the work-potential
energy equation is given by

$$\begin\{aligned\}
    W_\{a\to b\} = \int_\{C\} \vec\{F\}(x) \cdot dx
\end\{aligned\}$$

where $C$ is any trajectory between two points $a$ and $b$. Note that
$W_\{a\to b\}: \mathbb\{R\}$. For the case of electrostatic potential
energy, we want to take one of these points to be infinitely far away,
to be a reference point with zero energy. Put fancifully
$$\begin\{aligned\}
    U(r) &= \int_C \vec\{E\}(\vec\{x\}) \cdot dx \\
    &= W_\{\infty \to r\} 
\end\{aligned\}$$

## Multiple Point Particles

Let's now look at a more complex system. Consider a collection of $N$
particles each of which has charge $q_i$ and is located at location
$\vec\{x_i\}$. These particles create an electric field $E$ which extends
throughout space. Formally, the electric field is a function
$\mathbb\{R\}^3 \to \mathbb\{R\}^3$ defined as

$$\vec\{E\}(\vec\{r\}) = \frac\{1\}\{4 \pi \epsilon_0\} \sum_\{i=1\}^N \frac\{q_i\}\{\|\vec\{r\} - \vec\{x_i\}\|^2\}  \frac\{\vec\{r\}-\vec\{x_i\}\}\{\|\vec\{r\} - \vec\{x_i\}\|\}$$

We can turn this into a differentiable program simply as follows

    def E($n$: $\mathbb\{N\}$, [$q_i$]: $\mathbb\{R\}^n$, [$x_i$]: $\mathbb\{R\}^\{3n\}$, x: $\mathbb\{R\}^3$) -> $\mathbb\{R\}^3$:
      return sum([E($\epsilon_0$, qi, xi, x) 
                  for (qi, xi) in zip([$q_i$], [$x_i$])])

Note that the electric field is a vector field. Now suppose that we have
a new particle at $\vec\{u\}$ with charge $q$. We can compute the force
from the electric field as before with the equation

$$\vec\{F\}(\vec\{u\}) = \vec\{E\}(\vec\{u\}) q$$

The challenge here is that all particles exert forces on each other, so
the dynamics of a multibody electrostatic system can grow complex very
quickly. Let's try to write down a formal physical theory for this
system and transform it into series of associated differentiable
programs.

What's the state space $\mathcal\{S\}$? Conceptually, we have to \"glue
together\" the states spaces for $n$ point charges. A static point
charge $q$ with mass $m$ lives at a position in $\mathbb\{R\}^3$. We know
from before that we treat charge $q$ as a parameter. Is $\mathbb\{R\}^3$ a
sufficient state space for a point charge? Not if we want allow the
point charge to move. In that case, we also want to track the velocity
of the point charge. Note that we don't need to know the acceleration of
the point charge since we can compute the force on any given point
charge using Coulomb's law and back out the acceleration from Newton's
laws. This suggests each particle has a state in $\mathbb\{R\}^6$ and that
the full system has state space $\mathbb\{R\}^\{6n\}$.

What are the parameters for our system? Well each point charge has a
mass $m_i \in \mathbb\{R\}^+$ and a charge $q_i \in \mathbb\{R\}$. In
addition, each point charge has initial conditions
$\vec\{x_i\}(0) \in \mathbb\{R\}^3$ and $\vec\{v_i\}(0) \in \mathbb\{R\}^3$. We
can put all these together and say that the parameter space is

$$\begin\{aligned\}
    \mathcal\{W\} &= (\mathbb\{R\}^+, \mathbb\{R\}, \mathbb\{R\}^3, \mathbb\{R\}^3)^n
\end\{aligned\}$$

Let's now think about symmetries the system has to satisfy. There's no
friction or radiation or other mechanisms to \"leak\" energy, so we must
have that the energy of the system is conserved. We know that particles
can have kinetic energy and potential energy. What's the total energy
for a given particle at time $t = 0$? We can write it down as

$$\begin\{aligned\}
    E_i = \frac\{1\}\{2\}m_i \|\vec\{v_i\}(0)\|^2 + \frac\{1\}\{4\pi \epsilon_0\} \sum_\{j \neq i\} \frac\{q_iq_j\}\{\|\vec\{x_i\} - \vec\{x_j\}\|\}
\end\{aligned\}$$

The first term is the kinetic energy for particle $i$. The second term
computes the potential energy of particle $i$ with respect to every
other particle $j$ and sums up these contributions. The total energy of
the system is then simply

$$\begin\{aligned\}
E &= \sum_\{i=1\}^n E_i \\
  &= \sum_\{i=1\}^n \left (\frac\{1\}\{2\} m_i \|\vec\{v_i\}(0)\|^2 + \frac\{1\}\{4\pi\epsilon_0\}\sum_\{j \neq i\} \frac\{q_iq_j\}\{\|\vec\{x_i\} - \vec\{x_j\}\|\} \right )
\end\{aligned\}$$

This quantity $E$ is conserved through the time evolution of the system.
We also know that momentum and angular momentum are conserved for this
system but we will leave the details to the reader.

Let's now turn to the problem of of computing the time evolution of this
system. In previous chapters we've seen how to use Newton's equations to
compute the time evolution of moving particles. We can use this same
strategy in principle to solve for the time evolution of this system. By
Newton's laws, the acceleration on the $i$-th particle in the system is
given by the equation $\vec\{a_i\} = \frac\{1\}\{m_i\} \vec\{F_i\}$ where the
force $F_i$ on particle $i$ is given by $$\begin\{aligned\}
\vec\{F_i\} = \frac\{1\}\{4 \pi \epsilon_0\} \sum_\{j \neq i\} \frac\{q_iq_j\}\{\|\vec\{x_i\} - \vec\{x_j\}\|^2\} \frac\{\vec\{x_i\} - \vec\{x_j\}\}\{\|\vec\{x_i\} - \vec\{x_j\}\|\}
\end\{aligned\}$$ This leads to time evolution equations $$\begin\{aligned\}
\vec\{U\}(t) = \vec\{x\}(0) + \int_0^t \vec\{v\}(0) + \left (\int_0^v \frac\{\vec\{F_i\}\}\{m\}(u) du \right ) dv
\end\{aligned\}$$ Superficially, these equations are very similar to those
we saw earlier for a particle moving under the effect of gravity on the
surface of the earth. However, the function we are integrating over is
dramatically more complex than it was previously! The reality is that in
most cases we hold no real ability to analytically integrate these
equations. However, we can very reasonably still write a differentiable
program for the system.

Note furthermore that the equations we have defined are vectorial
equations. It isn't possible to integrate for $\vec\{x\}_i$ by itself
since the force on the $i$-the particle depends on the positions of all
the other particles in the system.

    def U([$q_i$]: $\mathbb\{R\}^n$, [$x_i(0)$]: $\mathbb\{R\}^\{3n\}$, [$v_i(0)$]: $\mathbb\{R\}^\{3n\}$) -> $\mathbb\{R\}^\{6n\}$:
      return $x_i$ + Integrate($v_i$ + Integrate($q_i$*E(...), 0, v), 0, t)

As always there are some restrictions to the domain of applicability of
our physical theory. First all particles must retain some minimum
distance from each other in the initial conditions. That is
$$\|x_i - x_j\| > \delta$$ where $\delta$ is some small number. This
restriction is due to the fact that the model as point particles doesn't
make sense at very small distances. For an accurate model in this
domain, we have to use quantum mechanics. Next, all particles must have
velocity that isn't too large. That is, $$\|v_i \| \ll c$$ The reason
for this is that this model isn't set up to handle relativistic effects.
We also have to place some restrictions on our charges as well. All
charges must be not too large. That is, $$|q_i| < Q$$ where $Q$ is some
charge \"ceiling.\" And as before, we will require that the particles we
consider are neither too light nor too large. $$\begin\{aligned\}
    M_\{\textrm\{min\}\} \ll m_i \ll M_\{\textrm\{max\}\}
\end\{aligned\}$$

Let's assume that we can measure the force on a tiny \"test charge\" $q$
at each point $\vec\{x\}$ up to Gaussian noise (with variance $\epsilon$)
to get our observation model.
$$\vec\{F\}_\{\textrm\{measured\}\} = \frac\{1\}\{4 \pi \epsilon_0\} \sum_\{j \neq i\} \frac\{qq_j\}\{\|\vec\{x\} - \vec\{x_j\}\|^2\} \frac\{\vec\{x\} - \vec\{x_j\}\}\{\|\vec\{x\} - \vec\{x_j\}\|\} + \textrm\{Normal\}(0, \epsilon)$$

::: center
       States                                                                        $\mathcal\{S\} = \mathbb\{R\}^\{6n\}$
  ----------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------
     Symmetries                                                                             $\mathcal\{G\} = \{\
                             E = \sum_\{i=1\}^N \left (\frac\{1\}\{2\}m_i \|\vec\{v_i\}\|^2 + \frac\{1\}\{4\pi \epsilon_0\}\sum_\{i \neq j\} \frac\{q_i q_j\}\{\|\vec\{x_i\} - \vec\{x_j\} \|\} \} \right )
                                                                                                     \}$
      Operators                         $\mathcal\{O\} = \{\vec\{U\}(t) = \vec\{x\}(0) + \int_0^t \vec\{v\}(0) + \left (\int_0^v \frac\{\vec\{F_i\}\}\{m\}(u) du \right ) dv \}$
     Parameters                           $\mathcal\{W\} = \{(m_i, q_i, \vec\{x_i\}(0), \vec\{v_i\}(0))\} = (\mathbb\{R\}^+, \mathbb\{R\}, \mathbb\{R\}^3, \mathbb\{R\}^3)^n$.
     Constraints                                                       $\mathcal\{C\} = \{\vec\{v\} \ll c, \|x_i - x_j\| \gg \delta \}$
   Hyperparameters                                   $\mathcal\{HP\} = \{M_\{\textrm\{min\}\} \ll m \ll M_\{\textrm\{max\}\}, \delta, c, q_i \ll Q, \epsilon\}$
     Observables                                         $\mathcal\{B\} = \{\vec\{F\}_\{\textrm\{measured\}\} = \vec\{F\}(x) + \mathcal\{N\}(0, \epsilon) \}$

[]\{#phs:theory:moving:particle label="phs:theory:moving:particle"\}\
*Summary of physical theory for a collection of point charges.*
:::


# Maxwell's Equations \{#chap:maxwells_equations\}

------------------------------------------------------------------------

\
**Prerequisites:**
[\[chap:electrostatics\]](#chap:electrostatics)\{reference-type="ref+label"
reference="chap:electrostatics"\},
[\[chap:electric_current\]](#chap:electric_current)\{reference-type="ref+label"
reference="chap:electric_current"\}\
**Difficulty Level:** \*\*\

------------------------------------------------------------------------

Maxwell's equations are a collection of coupled partial differential
equations that relate the electric and magnetic fields to one another.

Let the electric and magnetic fields be given by $$\begin\{aligned\}
E: &\mathbb\{R\}^3 \to T \mathbb\{R\}^3 \\
B: &\mathbb\{R\}^3 \to T \mathbb\{R\}^3
\end\{aligned\}$$ Let $\rho: \mathbb\{R\}^3 \to \mathbb\{R\}$ be a charge
density function which tracks the continuous amount of charge at a given
location.

Maxwell's laws are defined by four equations that we discuss in the
following sections. The four equations are coupled to one another and
jointly define the electrical and magnetic fields as a set of 4 coupled
PDEs.

## Gauss's Law

Gauss's law dictates how a given charge distribution induces an electric
field. We state the law below in its differential form.

$$\begin\{aligned\}
\nabla \cdot E = \frac\{\rho\}\{\epsilon_0\}
\end\{aligned\}$$

Gauss's law can be viewed as a statement that the electric charge
contained within a region of space induces a \"flow\" outwards of the
electric field as measured by the divergence of the electric field.

If the electric field is given by a potential, Gauss's law turns into
Poisson's equation $$\begin\{aligned\}
\nabla^2 V &= - \frac\{\rho\}\{\varepsilon_0\}
\end\{aligned\}$$

## Gauss's Law for Magnetism

Gauss's law for magnetism stands in contrast to Gauss's law. There is no
concept of a \"magnetic charge\" that induces an outward flow in the
magnetic field. In fact, the magnetic field must always have divergence
0. $$\begin\{aligned\}
\nabla \cdot B = 0
\end\{aligned\}$$

## Faraday's Law of Induction

The two versions of Gauss's law have treated the electric and magnetic
fields in isolation. Faraday's law describes how a time varying magnetic
field induces an electric field. $$\begin\{aligned\}
\nabla \times E = - \frac\{\partial B\}\{\partial t\}
\end\{aligned\}$$

## Ampère's Law

Ampère's law describes how both electric current and a time varying
electric field induce a magnetic field $$\begin\{aligned\}
\nabla \times B = \mu_0 \left (J + \epsilon_0 \frac\{\partial E\}\{\partial t\} \right )
\end\{aligned\}$$

## A Physical Theory for Maxwell's Equations

In this section, we transform Maxwell's laws into a physical theory in
our formulation. The state space is given by a tuple for the electric
and magnetic fields $$\begin\{aligned\}
\mathcal\{S\} &= (\mathbb\{R\}^3 \to T\mathbb\{R\}^3)^2 \\
(E, B) &\in \mathcal\{S\}
\end\{aligned\}$$ The state is the pair of the current electric and
magnetic fields $(E, B)$. We define the electromagnetic energy density
as $$\begin\{aligned\}
U = \frac\{\epsilon_0 \|E\|^2\}\{2\} + \frac\{\|B\|^2\}\{2 \mu_0\}
\end\{aligned\}$$ and the energy flux $u$ as $$\begin\{aligned\}
u &= \frac\{E \times B\}\{\mu_0\}
\end\{aligned\}$$ The energy density obeys the conservation equation
$$\begin\{aligned\}
\frac\{\partial U\}\{\partial t\} + \nabla \cdot u &= - E \cdot J
\end\{aligned\}$$

The evolution of the system is governed by the solution to Maxwell's
equations. The parameters of the theory are given by $$\begin\{aligned\}
\mathcal\{W\} &= \{E_0, B_0, \epsilon_0, \mu_0\}
\end\{aligned\}$$ where $E_0$ and $B_0$ are the initial electric and
magnetic fields. The domain of applicability $\mathcal\{C\}$ is governed
by the fact that the magnitude of the fields shouldn't get too large

$$\begin\{aligned\}
|E_0|, |B_0| < C
\end\{aligned\}$$

The hyperparameters are given by $$\begin\{aligned\}
\mathcal\{HP\} = \{C, \epsilon \}
\end\{aligned\}$$

The observables $\mathcal\{B\}$ are defined as follows. Using a test
charge we can measure the electric and magnetic field strengths at a
point up to some noise $$\begin\{aligned\}
f(E, B, x) = (E(x) + \textrm\{Normal\}(0, \epsilon), B(x) + \textrm\{Normal\}(0, \epsilon))
\end\{aligned\}$$

## A Lagrangian for Maxwell's Equations

Let's now introduce a Lagrangian view of this system. Let's start with a
few definitions. Let $E$ be an electric field. Let $B$ be a magnetic
field. The magnetic vector potential is defined as the solution to the
following equation $$\begin\{aligned\}
    B &= \nabla \times A
\end\{aligned\}$$ The scalar potential $\phi(\vec\{r\}, t)$ is then defined
as the solution to the following equation. $$\begin\{aligned\}
    E(\vec\{r\}, t)  &= - \nabla \phi - \frac\{\partial A\}\{\partial t\}
\end\{aligned\}$$

The minimal coupling Lagrangian of a charged particle with mass $m$ and
charge $q$ is defined as $$\begin\{aligned\}
    L = \frac\{1\}\{2\} m \vec\{v\}^T\vec\{v\} + q \vec\{v\}^TA - q \phi 
\end\{aligned\}$$ where $\vec\{v\} = \frac\{d \vec\{r\}\}\{dt\}$ is the velocity


# Classical Field Theory \{#chap:classic_fields\}

------------------------------------------------------------------------

\
**Prerequisites:**
[\[chap:maxwells_equations\]](#chap:maxwells_equations)\{reference-type="ref+label"
reference="chap:maxwells_equations"\},\
**Difficulty Level:** \*\*\*\

------------------------------------------------------------------------

The physical theories we've considered so far all have had finite sets
of parameters. But for many more complex physical systems, we find that
we're interested in modeling systems with an infinite number of
parameters.

We define a scalar field $\varphi$ is a function
$\mathbb\{R\}^4 \to \mathbb\{R\}$ where we use $\mathbb\{R\}^4$ to denote
spacetime.

In
[\[chap:maxwells_equations\]](#chap:maxwells_equations)\{reference-type="ref+label"
reference="chap:maxwells_equations"\} we saw our first example of a field
theory in this book. We will cover a number more field theories in
future chapters.
