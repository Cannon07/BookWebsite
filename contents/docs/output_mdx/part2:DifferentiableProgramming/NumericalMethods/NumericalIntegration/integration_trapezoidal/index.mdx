# Integration with the Trapezoidal Rule \{#chap:trapezoidal\}

------------------------------------------------------------------------

\
**Prerequisites:**
[\[chap:calculus\]](#chap:calculus)\{reference-type="ref+label"
reference="chap:calculus"\}\
**Difficulty Level:** \*\

------------------------------------------------------------------------

In this chapter we will explain how Newton-Cotes integration formulas
are based on the strategy of replacing a complicated function or
tabulated data with a polynomial that is easy to integrate. We will then
learn how to implement the single and composite application Newton-Cotes
formulas using the Trapezoidal rule.

## Introduction

Integration is one of the two main operations of calculus, with its
inverse, differentiation, being the other. In most engineering and
physical applications, the integrand $f(x)$ may be known only at certain
points, such as obtained by sampling, which calls for computing an
approximate solution to a definite integral or numerical integration. In
some other cases, a formula for the integrand may be known, but it may
be difficult or impossible to find an antiderivative that is an
elementary function. In numerical integration, the problem is to compute
an approximate solution to $$\begin\{aligned\}
I &= \int_\{a\}^\{b\} f(x) dx
\end\{aligned\}$$ to a given degree of accuracy. Integration can also be
interpreted as the total value, or summation, of $f(x) dx$ over the
range $x = a$ to $b$. The integral corresponds to the area under the
curve of $f(x)$ between $x = a$ and $b$.

::: marginfigure
![image](figures/part1b/integration_trapezoidal/integration0.png)\{width="2.4in"\}
:::

::: marginfigure
![image](figures/part1b/integration_trapezoidal/intro_0.png)\{width="2.4in"\}
:::

For example, consider a non-uniform wind blowing against the leaning
tower of Pisa given by velocity $v\mathrm\{m\}/\mathrm\{s\}$ as a function
of position. Since the velocity is location dependent, we can write
force $F$ as $$\begin\{aligned\}
F &= 0.5\rho\sum_\{i=1\}^\{n\} (\Delta A_i v_i^2)
\end\{aligned\}$$ where $n$ is the number of discrete area segments,
$\rho$ is the air density and $A$ is the surface area. For the
continuous case, where $v(x, y)$ is a known function, numerical
integration yields $$\begin\{aligned\}
F &= 0.5\rho\int\int v(x,y)^2 dA
\end\{aligned\}$$ Similarly, the percentage of charge $C$ left in your
phone is displayed by calculating the integral of instantaneous current
$I(t)$ over time given by $$\begin\{aligned\}
C = \int_\{t_1\}^\{t_2\} I(t) dt
\end\{aligned\}$$ Your monthly electricity bill is compiled based on the
total electrical energy $E$ consumed give by the numerical integral of
the instantaneous power $P(t)$ over the entire month, $$\begin\{aligned\}
E = \int_\{t_1\}^\{t_2\} P(t) dt
\end\{aligned\}$$ In the context of stocks and shares, the average value
of a share is evaluated over a period by computing the cost integral
over time and dividing by the time-period length. Approximate values for
integrals are obtained by using numerical integration techniques as
described next.

## Newton-Cotes Formulas

In this method a complicated function or tabulated data is replaced with
a polynomial that is easy to integrate:

$$\begin\{aligned\}
I = \int_\{a\}^\{b\} f(x) dx \cong \int_\{a\}^\{b\} f_n(x) dx
\end\{aligned\}$$ where $f_n(x)$ is a polynomial of the form
$$\begin\{aligned\}
f_n(x) = a_0 + a_1x + a_2x^2 + ... + a_\{n-1\}x^\{n-1\} + a_nx^n
\end\{aligned\}$$

::: marginfigure
![image](figures/part1b/integration_trapezoidal/polynomial0.png)\{width="2.4in"\}
:::

where $n$ is the order of the polynomial. For example, in Fig.
[\[fig:3\]](#fig:3)\{reference-type="ref" reference="fig:3"\}a, a
first-order polynomial (a straight line) is used as an approximation. In
Fig. [\[fig:3\]](#fig:3)\{reference-type="ref" reference="fig:3"\}b, a
parabola is employed for the same purpose. The integral can also be
approximated using a series of polynomials applied piecewise to the
function or data over segments of constant length. For example, in Fig.
[\[fig:4\]](#fig:4)\{reference-type="ref" reference="fig:4"\}, three
straight-line segments are used to approximate the integral.
Higher-order polynomials can be utilized for the same purpose.

::: marginfigure
![image](figures/part1b/integration_trapezoidal/piecewise0.png)\{width="2.4in"\}
:::

Newton-Cotes formulas include closed and open forms. The closed forms
are those where the data points at the beginning and end of the limits
of integration are known. The open forms have integration limits that
extend beyond the range of the data. In this lecture we will deal with
closed forms.

## The Trapezoidal Rule

The trapezoidal rule is the first of the Newton-Cotes closed integration
formulas. It corresponds to the case where the polynomial is
first-order: $$\begin\{aligned\}
I = \int_\{a\}^\{b\} [f(a) + \dfrac\{f(b) - f(a)\}\{b - a\}(x - a)] dx
\end\{aligned\}$$ The result of integration is called the trapezoidal
rule. $$\begin\{aligned\}
I = (b - a)\dfrac\{f(a) + f(b)\}\{2\}
\end\{aligned\}$$ Geometrically, the trapezoidal rule is equivalent to
approximating the area of the trapezoid under the straight line
connecting $f (a)$ and $f (b)$ in
Fig.[\[fig:5\]](#fig:5)\{reference-type="ref" reference="fig:5"\}. Now
area of a trapezoid is height times the average of the bases.
$$\begin\{aligned\}
I &= \mathrm\{width\} \times \mathrm\{average\ height\} \\
&= (b-a) \times \dfrac\{[f(a)+f(b)]\}\{2\}
\end\{aligned\}$$ We can convert this into Physika code directly as
follows

``` \{.python language="python"\}
def trapezoidal_rule(f: $\mathbb\{R\} \to \mathbb\{R\}$, a: $\mathbb\{R\}$, b: $\mathbb\{R\}$) $\to$ $\mathbb\{R\}$:
  (b - a) * (f(b) + f(a))/2
```

::: marginfigure
![image](figures/part1b/integration_trapezoidal/trapezoidal0.jpg)\{width="2.4in"\}
:::

### Error of the Trapezoidal Rule

When we employ the integral under a straight-line segment to approximate
the integral under a curve, we obviously can incur an error that may be
substantial. An estimate for the local truncation error of a single
application of the trapezoidal rule is

$$\begin\{aligned\}
E_t = -\dfrac\{1\}\{12\}f''(\xi)(b-a)^3
\end\{aligned\}$$ where $\xi$ lies somewhere in the interval from $a$ to
$b$. The above equation indicates that if the function being integrated
is linear, the trapezoidal rule will be exact because the second
derivative of a straight line is zero. Otherwise, for functions with
second- and higher-order derivatives, some error can occur.

### The Composite Trapezoidal Rule

One way to improve the accuracy of the trapezoidal rule is to divide the
integration interval from $a$ to $b$ into a number of segments and apply
the method to each segment (Fig.
[\[fig:6\]](#fig:6)\{reference-type="ref" reference="fig:6"\}). The areas
of individual segments can then be added to yield the integral for the
entire interval. The resulting equations are called composite, or
multiple-segment, integration formulas. There are $n + 1$ equally spaced
base points $(x_0, x_1, x_2, . . . , x_n)$. Consequently, there are $n$
segments of equal width: $$\begin\{aligned\}
h = \dfrac\{b-a\}\{n\}
\end\{aligned\}$$

::: marginfigure
![image](figures/part1b/integration_trapezoidal/composite0.jpg)\{width="2.4in"\}
:::

If $a$ and $b$ are designated as $x_0$ and $x_n$, respectively, the
total integral can be represented as $$\begin\{aligned\}
I = \int_\{x_0\}^\{x_1\} f(x) dx + \int_\{x_1\}^\{x_2\} f(x) dx + \dotsc + \int_\{x_\{n-1\}\}^\{x_n\} f(x) dx
\end\{aligned\}$$ Substituting the trapezoidal rule for each integral and
grouping yields $$\begin\{aligned\}
I &= h\dfrac\{f(x_0) + f(x_1)\}\{2\} + h\dfrac\{f(x_1) + f(x_2)\}\{2\} + ... + h\dfrac\{f(x_\{n-1\}) + f(x_n)\}\{2\}\\
&= \dfrac\{h\}\{2\}[f(x_0) + 2\sum_\{i=1\}^\{n-1\}f(x_i)+f(x_n)] \\
&= (b-a)\dfrac\{f(x_0) + 2\sum_\{i=1\}^\{n-1\}f(x_i)+f(x_n)\}\{2n\}
\end\{aligned\}$$ According to the above equation, the interior points are
given twice the weight of the two end points $f(x_0)$ and $f(x_n)$. We
can again directly convert this implementation into Physika

``` \{.python language="python"\}
def composite_trapezoidal_rule(f: $\mathbb\{R\} \to \mathbb\{R\}$, xs: $\mathbb\{R\}^n$) $\to$ $\mathbb\{R\}$:
  b = xs[n-1], a = xs[0]
  (b-a)*(f(xs[0]) + 2*sum(
    [f(xs[i]) for i in range(1,n)]) + f(xs[n-1]))/(2*n)
```

An error for the composite trapezoidal rule can be obtained by summing
the individual errors for each segment to give $$\begin\{aligned\}
E_t = -\dfrac\{(b-a)^3\}\{12n^3\}\sum_\{i=1\}^\{n\}f''(\xi_i)
\end\{aligned\}$$ where $f''(\xi_i)$ is the second derivative at a point
$\xi_i$ located in segment $i$. This result can be simplified by
estimating the mean or average value of the second derivative for the
entire interval as $$\begin\{aligned\}
\bar\{f''\} \cong \dfrac\{\sum_\{i=1\}^\{n\}f''(\xi_i)\}\{n\}
\end\{aligned\}$$ Therefore $\sum f''(\xi_i) = \cong n\bar\{f''\}$ and hence
we have $$\begin\{aligned\}
E_a = -\dfrac\{(b-a)^3\}\{12n^2\}\bar\{f''\}
\end\{aligned\}$$ Therefore the error decreases as the number of segments
increases. However, the rate of decrease is gradual because the error is
inversely related to the square of $n$. Therefore, doubling the number
of segments quarters the error. Note that above equation is an
approximate error.
