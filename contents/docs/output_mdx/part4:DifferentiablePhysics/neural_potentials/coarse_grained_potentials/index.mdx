# Coarse Grained Potentials \{#chap:coarse\}

------------------------------------------------------------------------

\
**Prerequisites:**
[\[chap:molecular_hamiltonian\]](#chap:molecular_hamiltonian)\{reference-type="ref+label"
reference="chap:molecular_hamiltonian"\},\
**Difficulty Level:** \*\*\

------------------------------------------------------------------------

Coarse grained potentials hold out the promise of being able to enable
simulations at much larger scales. However, the usability of these
techniques has been limited by the challenge of parameterizing coarse
grained force fields. New differentiable programming techniques hold out
the promise of making coarse graining much more effective in practice.

## Mathematical Framework

Consider a system with $N$ atoms in a constant-volume NVT ensemble. Let
the coordinates of each atom be given by

$$\begin\{aligned\}
q = (q_1,\dotsc, q_N) \in \mathbb\{R\}^\{3N\}
\end\{aligned\}$$ We define the coarse grained variables $$\begin\{aligned\}
\xi(q) &= \xi_1(q),\dotsc,\xi_M(q)
\end\{aligned\}$$ to be a smaller set of parameters with $M \ll 3N$.
Suppose that the original probability distribution of the system is
given by $$\begin\{aligned\}
p(q) &= \frac\{1\}\{Z\} e^\{-\beta V(q)\}
\end\{aligned\}$$ where $Z$ is the partition function and $V$ is the
potential energy. We can then define the probability distribution for
the coarse-grained variables by $$\begin\{aligned\}
p(\xi) &= \frac\{1\}\{Z\} \int e^\{-\beta V(q)\} \delta(\xi(q) - \xi) dq
\end\{aligned\}$$ This equation effectively sums over all full resolution
states that collapse to coarse grained state $\xi$. We can also define a
potential energy and forces on the coarse grained states by
$$\begin\{aligned\}
U(\xi) &= -\frac\{1\}\{\beta\} \ln p(\xi) \\
F(\xi) &= - \nabla_\{\xi\} U(\xi)
\end\{aligned\}$$ Unlike the classical potential, we may not have a
closed-form for the coarse grained potential $U$ but we can represent it
as a differentiable program.

## Machine Learned Coarse Grained Potentials

To define a differentiable coarse-grained potential, we need to define
the coarse graining mechanism to extract $\xi$ and we need to define a
parameterized representation for $U(\xi)$. Assuming we have a
coarse-grained form selected, we can parameterize the potential by a
network $$\begin\{aligned\}
U_\theta(\xi)
\end\{aligned\}$$ If our coarse-graining scheme breaks the original system
into coarse-grained \"particles\", we can write $$\begin\{aligned\}
U_\theta(\xi) &= \sum_i U_\{i,\theta\}(\xi)
\end\{aligned\}$$ where we sum the per-particle contribution in the
Behler-Parrinello style.

Training this model requires some subtlety since high resolution
trajectories have to be transformed into coarse-grained settings before
we can train with standard methods like force-matching.
