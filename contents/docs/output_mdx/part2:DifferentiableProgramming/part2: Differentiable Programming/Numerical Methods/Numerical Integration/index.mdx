# Numerical Integration with Gaussian Quadrature \{#chap:gauss_quadrature\}

------------------------------------------------------------------------

\
**Prerequisites:**
[\[chap:calculus\]](#chap:calculus)\{reference-type="ref+label"
reference="chap:calculus"\},
[\[chap:trapezoidal\]](#chap:trapezoidal)\{reference-type="ref+label"
reference="chap:trapezoidal"\}\
**Difficulty Level:** \*\*\

------------------------------------------------------------------------

In this chapter, we learn how Gaussian quadrature provides for superior
integral estimates by picking optimal abcissas at which to evaluate the
function. We study the importance of Gauss-Hermite and Gauss-Laguerre
quadratures for estimating integrals with $\infty$ limits. We then study
the use of Gauss-Legendre quadrature for approximating integrals with
finite limits.

## Gaussian Quadrature

So far, we have employed the Newton-Cotes equations to evaluate the
integrals. However, these methods provide estimates for integrals but
are not exact. In addition, they cannot be used to evaluate improper
integrals, which are definite integrals that have either or both of the
limits infinite. These cases will have to be approximated further and
evaluated using large numbers tending to infinity. For example, consider
the integral $\int_\{-\infty\}^\{\infty\}e^\{-x^2\}\tan(x)dx$. The methods
discussed in the previous chapters (Trapezoidal and Simpson's Rule) will
yield results with large error. The Gauss quadrature methods discussed
in this chapter will enable us to evaluate these integrals either
exactly or with high accuracy.

In numerical analysis, *quadrature* rule is an approximation of the
integral of a function, usually stated as a weighted sum of function
values at specified points within the domain of integration. By choosing
these weights and positioning these specified points mathematically
wisely, a very accurate estimate of the integral is obtained. These
quadrature methods extend to integrals with infinite limits in addition
to cases with finite limits. Note that any integral with finite limits
can be converted to an integral going from $-1$ to $1$ by a simple
change of variables, which will be used in the Gauss-Legendre quadrature
later. The general $n$-point quadrature rule is given as
$$\begin\{aligned\}
I \cong c_0f(x_0) + c_1f(x_1) + \dots + c_\{n-1\}f(x_\{n-1\})
\end\{aligned\}$$ where $c_i$ are the weights, $x_i$ are the points and
$n$ is the number of points to be chosen.

To evaluate such integrals, three common quadrature rules are used

1.  *Gauss-Hermite Quadrature* evaluates integrals of the form
    $\int_\{-\infty\}^\{\infty\}e^\{-x^2\}f(x)dx$. It can be extended to
    improper integrals of any function with both limits unbounded.

2.  *Gauss-Legendre Quadrature* evaluates integrals of the form
    $\int_\{-1\}^\{1\}f(x)dx$. For polynomial functions of degree up to
    $2n-1$, function evaluations at $n$ chosen points and corresponding
    weights yield exact integral value.

3.  *Gauss-Laguerre Quadrature* evaluates integrals of the form
    $\int_\{0\}^\{\infty\}e^\{-x\}f(x)dx$. It can be extended to improper
    integrals of any function with one of the two limits unbounded.

Gauss quadrature yields the exact integral or a highly accurate estimate
in cases where the function $f(x)$ to be integrated is known. For
engineering applications where tabulated data is given at specific $x$
values, a fit to the data is necessary to obtain the functional form, or
if the functional form is knows from the physics of the system, Gauss
quadrature can be used by interpolating at the quadrature points from
the tabulated data. When the functional form is arbitrary or unknown,
methods like Trapezoidal rule and Simpson's rule are favorable.

## Gauss-Hermite Quadrature

## Gauss-Legendre Quadrature

Gauss-Legendre Quadrature is used to evaluate integrals with both the
limits as finite which are of the form $\int_\{-1\}^\{1\}f(x)dx$. Using the
two-point approximation,

$$\begin\{aligned\}
I = \int_\{-1\}^\{1\}f(x)dx \cong c_0f(x_0) + c_1f(x_1)
\end\{aligned\}$$

where the $c$'s are the unknown coefficients. Thus, we now have a total
of four unknowns $c_0, c_1, x_0, x_1$ that must be evaluated, and
consequently, we require four conditions to determine them exactly.

We can obtain two of these conditions by assuming that the above
equation fits the integral of a constant and a linear function exactly.
Then, to arrive at the other two conditions, we merely extend this
reasoning by assuming that it also fits the integral of a parabolic
($y = x^2$) and a cubic ($y = x^3$) function. By doing this, we
determine all four unknowns and in the bargain derive a linear two-point
integration formula that is exact for cubics.

::: marginfigure
![image](figures/part1b/gauss_quadrature/twopoint01.png)\{width="2.7in"\}
:::

The four equations to be solved are $$\begin\{aligned\}
    c_0 + c_1 &= \int_\{-1\}^\{1\}1dx = 2\\
    c_0x_0 + c_1x_1 &= \int_\{-1\}^\{1\}xdx = 0\\
    c_0x_0^2 + c_1x_1^2 &= \int_\{-1\}^\{1\}x^2dx = \frac\{2\}\{3\} \\
    c_0x_0^3 + c_1x_1^3 &= \int_\{-1\}^\{1\}x^3dx = 0
\end\{aligned\}$$ The symmetry of the weights and points in Gauss-Legendre
can be observed from the above results. On simultaneously solving the
above equations, we obtain, $$\begin\{aligned\}
c_0 = c_1 = 1, x_0 = -\frac\{1\}\{\sqrt\{3\}\}, x_1 = \frac\{1\}\{\sqrt\{3\}\}    
\end\{aligned\}$$ Therefore, the two-point Gauss-Legendre formula is
$$\begin\{aligned\}
I = f(-\frac\{1\}\{\sqrt\{3\}\}) + f(\frac\{1\}\{\sqrt\{3\}\})
\end\{aligned\}$$. Thus, we arrive at the interesting result that the
simple addition of the function values at $x$ = $-1/\sqrt\{3\}$ and
$1/\sqrt\{3\}$ yields an integral estimate that is third-order accurate.

Notice that the integration limits in the above equations are from -1
to 1. This was done to simplify the mathematics and to make the
formulation as general as possible. A simple change of variable can be
used to translate other limits of integration into this form. This is
accomplished by assuming that a new variable $x_d$ is related to the
original variable $x$ in a linear fashion, $x = a_1 + a_2x_d$. The lower
limit, $x$ = $a$, corresponds to $x_d$ = -1. The upper limit, $x$ = $b$,
corresponds to $x_d$ = 1. These are substituted in the equation above to
give, $$\begin\{aligned\}
    a &= a_1 + a_2(-1)\\
    b &= a_1 + a_2(1)
\end\{aligned\}$$ On solving the above equations for $a_1$, $a_2$ and
substituting for $x$, we get $$\begin\{aligned\}
    a_1 &= \dfrac\{b+a\}\{2\}\\
    a_2 &= \dfrac\{b-a\}\{2\}\\
    x &= \dfrac\{(b+a) + (b-a)x_d\}\{2\}
\end\{aligned\}$$ This equation can be differentiated to give
$x = \dfrac\{b-a\}\{2\}dx_d$ These substitutions effectively transform the
integration interval without changing the value of the integral.

    def gauss_legendre(f):
      return f($-1/\sqrt\{3\})$ + f($1/\sqrt\{3\})$ 

As an example, we can try evaluating $\int_\{-1\}^\{1\}\tan^2(x)dx$

``` \{.python language="python"\}
def f(x: $\mathbb\{R\}$): $\mathbb\{R\}$ 
  return tan(x)$^2$
I = gauss_legendre(f)
```

It can be observed that the actual value of the integral is
significantly different from the estimated integral from Gauss-Legendre
quadrature. This is because, Gauss-Legendre gives accurate results for
$(2N-1)^\{th\}$ order functions. In our case, since $N=2$, it can
accurately measure integrals of third-order functions. This can be
clearly observed from the next example.

Let's try evaluating $\int_\{-1\}^\{1\}(5x^3 + 7x^2 +  2x + 3)dx$

    def f(x: $\mathbb\{R\}$): $\mathbb\{R\}$ 
      return 5*x$^3$ + 7*x$^2$ + 2*x + 3;
    I =gauss_legendre(f)

## Gauss-Laguerre Quadrature

Gauss-Laguerre Quadrature is used to evaluate improper integrals with
one of the limits as $\infty$ which are of the form
$\int_\{0\}^\{\infty\}e^\{-x\}f(x)dx$. Using the two-point approximation,

$$\begin\{aligned\}
I = \int_\{0\}^\{\infty\}e^\{-x\}f(x)dx \cong c_0f(x_0) + c_1f(x_1)
\end\{aligned\}$$ where the $c$'s are the unknown coefficients. Thus, we
again have a total of four unknowns $c_0, c_1, x_0, x_1$ that must be
evaluated, and consequently, we require four conditions to determine
them exactly.

We can obtain two of these conditions by assuming that the above
equation fits the integral of a constant and a linear function exactly.
Then, to arrive at the other two conditions, we merely extend this
reasoning by assuming that it also fits the integral of a parabolic
($y = x^2$) and a cubic ($y = x^3$) function.

The two equations to be solved are $$\begin\{aligned\}
c_0 + c_1 &= \int_\{0\}^\{\infty\}e^\{-x\}dx = 1\\
c_0x_0 + c_1x_1 &= \int_\{0\}^\{\infty\}e^\{-x\}xdx = 1\\
c_0x_0^2 + c_1x_1^2 &= \int_\{0\}^\{\infty\}e^\{-x\}x^2dx = 2 \\  c_0x_0x_0^3 + c_1x_1^3 &= \int_\{0\}^\{\infty\}e^\{-x\}x^3dx = 6
\end\{aligned\}$$

On simultaneously solving the above equations, we obtain,
$$\begin\{aligned\}
c_0 = 0.8535533, c_1 = 0.1464466, x_0 = 0.58578643, x_1 = 3.41421356
\end\{aligned\}$$

It can be observed that $c_0x_0 = c_1x_1 = 1$. Therefore, the two-point
Gauss-Laguerre formula is

$$\begin\{aligned\}
I = 0.8535533f(0.58578643) + 0.1464466f(3.41421356)
\end\{aligned\}$$ As an example, let's try evaluating
$\int_\{0\}^\{\infty\}\log(1+e^\{-x\})dx$

``` \{.python language="python"\}
def f(x: $\mathbb\{R\}$): $\mathbb\{R\}$  
  return exp(x)*log(1+exp(-x))
I = gauss_laguerre(f)
```


# Simpson's Rule \{#chap:simpsons\}

------------------------------------------------------------------------

\
**Prerequisites:**
[\[chap:calculus\]](#chap:calculus)\{reference-type="ref+label"
reference="chap:calculus"\}\
**Difficulty Level:** \*\

------------------------------------------------------------------------

In this chapter, we study how to implement the single and composite
application Newton-Cotes formulas using Simpson's Rule. We recognize
that even-segment odd-point formulas like Simpson's 1/3 rule achieve
higher than expected accuracy.

## Simpson's Rule \{#simpsons-rule\}

::: marginfigure
![image](figures/part1b/simpsons_rule/polynomials01.png)\{width="2.7in"\}
:::

To obtain a more accurate estimate of an integral (instead of finer
segmentation of the trapezoidal rule) is to use higher-order polynomials
to connect the points. For example, if there is an extra point midway
between $f(a)$ and $f(b)$, the three points can be connected with a
parabola (Fig [\[fig:1\]](#fig:1)\{reference-type="ref"
reference="fig:1"\}a). If there are two points equally spaced between
$f(a)$ and $f(b)$, the four points can be connected with a third-order
polynomial (Fig [\[fig:1\]](#fig:1)\{reference-type="ref"
reference="fig:1"\}b). The formulas that result from taking the integrals
under these polynomials are called Simpson's rules. These formulas take
inspiration from the Taylor series expansion, as in approximating the
function with a higher order polynomial (rather than a linear function)
for more accurate representation.

The Simpson's 1/3 rule is the second of the Newton-Cotes closed
integration formulas. It corresponds to the case where the polynomial is
second-order. It is given as follows:

$$\begin\{aligned\}
I = \int_\{x_0\}^\{x_2\} & [\dfrac\{(x-x_1)(x-x_2)\}\{(x_0-x_1)(x_0-x_2)\}f(x_0) + \dfrac\{(x-x_0)(x-x_2)\}\{(x_1-x_0)(x_1-x_2)\}f(x_1) \\
&  + \dfrac\{(x-x_0)(x-x_1)\}\{(x_2-x_0)(x_2-x_1)\}f(x_2)] dx
\end\{aligned\}$$ The result of integration is is given as
$$\begin\{aligned\}
I = \frac\{h\}\{3\}[f(x_0) + 4f(x_1) + f(x_2)]
\end\{aligned\}$$

where $a$ and $b$ are designated as $x_0$ and $x_2$, respectively. In
this case $h = (b-a)/2$. This equation is known as Simpson's 1/3 rule.
The label 1/3 stems from the fact that h is divided by 3 in the above
equation.

Simpson's 1/3 rule can also be expressed using the format of the below
equation. $$\begin\{aligned\}
I =\text\{width\} \times \text\{weighted height\} = (b-a) \times \dfrac\{[f(x_0)+4f(x_1)+f(x_2)]\}\{6\}
\end\{aligned\}$$

where $a$ = $x_0$, $b$ = $x_2$, and $x_1$ = the point midway between $a$
and $b$, which is given by $(a + b)/2$. Notice that, according to the
above equation, the middle point is given more weight (two-thirds) and
the two end points are weighted by one-sixth. We can convert this
formula directly into Physika.

``` \{.python language="python"\}
def simpsons_1_3_rule(f: $\mathbb\{R\} \to \mathbb\{R\}$, a: $\mathbb\{R\}$, b: $\mathbb\{R\}$) $\to$ $\mathbb\{R\}$:
  (b - a) * (f(a) + 4*f((a+b)/2) + f(b))/6
```

### Error of the Simpson's rule

It can be shown that a single-segment application of Simpson's 1/3 rule
has a truncation error of $$\begin\{aligned\}
E_t = -\dfrac\{1\}\{90\}h^5f^\{(4)\}(\xi)
\end\{aligned\}$$ or, because $h$ = $(b-a)/2$

$$\begin\{aligned\}
E_t = -\dfrac\{(b-a)^5\}\{2880\}f^\{(4)\}(\xi)
\end\{aligned\}$$

where $\xi$ lies somewhere in the interval from $a$ to $b$. Thus,
Simpson's 1/3 rule is more accurate than the trapezoidal rule. However,
in comparison with the error term from trapezoidal rule indicates that
it is more accurate than expected. Rather than being proportional to the
third derivative, the error is proportional to the fourth derivative.
Consequently, Simpson's 1/3 rule is third-order accurate even though it
is based on only three points. In other words, it yields exact results
for cubic polynomials even though it is derived from a parabola.

### Derivation of the Truncation Error

Since Simpson's 1/3 rule approximates the function $f(x)$ as a quadratic
through $x_0$,$x_1$ and $x_2$. The integral of $f(x)$ is approximated
using Taylor Series about $x=x_1$ as

$$\begin\{aligned\}
I = \int_\{x_0\}^\{x_2\}f(x)dx = \int_\{x_0\}^\{x_2\}[f(x_\{1\}) + (x-x_1)f'(x_1) + \dfrac\{1\}\{2\}(x-x_1)^2f^\{(2)\}(x_1) + \\
\dfrac\{1\}\{6\}(x-x_1)^3f^\{(3)\}(x_1) + \dfrac\{1\}\{24\}(x-x_1)^4f^\{(4)\}(x_1)]dx
\end\{aligned\}$$

Making a change of variables such that $$\begin\{aligned\}
s = \dfrac\{2(x-x_1)\}\{x_2-x_0\} = \dfrac\{x-x_1\}\{h\}
\end\{aligned\}$$

$$\begin\{aligned\}
\int_\{x_0\}^\{x_2\}f(x)dx =  \int_\{-1\}^\{1\}&[hf(x_\{1\}) + h^2sf'(x_1) + \frac\{h^3\}\{2\}s^2f^\{(2)\}(x_1) + \\
&\frac\{h^4\}\{6\}s^3f^\{(3)\}(x_1) + \frac\{h^5\}\{24\}s^4f^\{(4)\}(x_1)]ds 
\end\{aligned\}$$

Simplifying the above expression(integrals of all odd functions are
zero) as $$\begin\{aligned\}
\int_\{x_0\}^\{x_2\}f(x)dx = hsf(x_\{1\}) + \frac\{1\}\{2\}h^2s^2f'(x_1) +  \frac\{1\}\{6\}h^3s^3f^\{(2)\}(x_1) + \frac\{1\}\{24\}h^4s^4f^\{(3)\}(x_1) + \frac\{1\}\{120\}h^5s^5f^\{(4)\}(x_1)\rvert_\{s=-1\}^\{s=1\}
\end\{aligned\}$$

Substituting the second order accurate approximation of the second
derivative as $$\begin\{aligned\}
f^\{(2)\}(x_1) = \dfrac\{f(x_0) - 2f(x_1) + 2f(x_2)\}\{h^2\} - \frac\{h^2\}\{12\}f^\{(4)\}(x_1)
\end\{aligned\}$$

The integral of $f(x)$ is simplified as $$\begin\{aligned\}
\int_\{x_0\}^\{x_2\}f(x)dx =  \frac\{h\}\{3\}[f(x_0) + 4f(x_1) + f(x_2)] - \underbrace\{\frac\{1\}\{90\}h^5f^\{(4)\}(x_1)\}_\{\text\{Truncation Error\}\}
\end\{aligned\}$$

## The Composite Simpson's 1/3 Rule

Just as with the trapezoidal rule, Simpson's rule can be improved by
dividing the integration interval into a number of segments of equal
width. The total integral can be represented as

$$I = \int_\{x_0\}^\{x_2\} f(x) dx + \int_\{x_2\}^\{x_4\} f(x) dx + ... + \int_\{x_\{n-2\}\}^\{x_n\} f(x) dx$$

Substituting Simpson's 1/3 rule for each integral and grouping yields
$$\begin\{aligned\}
I& = 2h\dfrac\{f(x_0) + 4f(x_1) + f(x_2)\}\{6\} + 2h\dfrac\{f(x_2) + 4f(x_3) + f(x_4)\}\{6\} + \\
&... + 2h\dfrac\{f(x_\{n-2\}) + 4f(x_\{n-1\}) + f(x_n)\}\{6\}\\
I &= (b-a)\dfrac\{f(x_0) + 4\sum_\{i=1,3,5\}^\{n-1\}f(x_i) + 2\sum_\{j=2,4,6\}^\{n-2\}f(x_j) + f(x_n)\}\{2n\}
\end\{aligned\}$$

It should be noted that, an even number of segments must be utilized to
implement the method. In addition, the coefficients $4$ and $2$ in the
above equation might seem peculiar at first glance. However, they follow
naturally from Simpson's 1/3 rule.

An error estimate for the composite Simpson's rule is obtained in the
same fashion as for the trapezoidal rule by summing the individual
errors for the segments and averaging the derivative to yield

$$\begin\{aligned\}
E_a = -\dfrac\{(b-a)^5\}\{180n^4\}\bar\{f^\{(4)\}\}
\end\{aligned\}$$ where $\bar\{f^\{(4)\}\}$ is the average fourth derivative
for the interval.

::: marginfigure
![image](figures/part1b/simpsons_rule/composite_simpsons_.png)\{width="2.7in"\}
:::

## Simpson's 3/8 Rule

In a similar manner to the derivation of the trapezoidal and Simpson's
1/3 rule, a third-order Lagrange polynomial can be fit to four points
and integrated to yield $$\begin\{aligned\}
I = \frac\{3h\}\{8\}[f(x_0) + 3f(x_1) + 3f(x_2) + f(x_3)]
\end\{aligned\}$$

where $h = (b-a)/3$. This equation is known as Simpson's 3/8 rule
because $h$ is multiplied by 3/8. It is the third Newton-Cotes closed
integration formula. The 3/8 rule can also be expressed as
$$\begin\{aligned\}
I = (b-a) \times \dfrac\{[f(x_0) + 3f(x_1) + 3f(x_2) + f(x_3)]\}\{8\}
\end\{aligned\}$$

Thus, the two interior points are given weights of three-eighths,
whereas the end points are weighted with one-eighth. We can express this
rule in Physika as follows:

``` \{.python language="python"\}
def simpsons_3_8_rule(f: $\mathbb\{R\} \to \mathbb\{R\}$, a: $\mathbb\{R\}$, b: $\mathbb\{R\}$) $\to$ $\mathbb\{R\}$:
  (b - a) * (f(a) + 3*f((a+b)/3) + 3*f(2*(a+b)/3) + f(b))/8
```

Simpson's 3/8 rule has an error of

$$\begin\{aligned\}
E_t = -\dfrac\{3\}\{80\}h^5f^\{(4)\}(\xi)
\end\{aligned\}$$ or, because $h$ = $(b-a)/3$ $$\begin\{aligned\}
E_t = -\dfrac\{(b-a)^5\}\{6480\}f^\{(4)\}(\xi)
\end\{aligned\}$$

Since the denominator of the $E_t$ for 3/8 rule is larger than that for
1/3 rule, the 3/8 rule is somewhat more accurate than the 1/3 rule.

::: marginfigure
![image](figures/part1b/simpsons_rule/simpsonsodd01.png)\{width="2.4in"\}
:::

Simpson's 1/3 rule is usually the method of preference because it
attains third-order accuracy with three points rather than the four
points required for the 3/8 version. However, the 3/8 rule has utility
when the number of segments is odd. Suppose that you desired an estimate
for five segments. One option would be to use a composite version of the
trapezoidal rule. This may not be advisable, however, because of the
large truncation error associated with this method. An alternative would
be to apply Simpson's 1/3 rule to the first two segments and Simpson's
3/8 rule to the last three as represented in Figure
[\[fig:3\]](#fig:3)\{reference-type="ref" reference="fig:3"\}. In this
way, we could obtain an estimate with third-order accuracy across the
entire interval.

### Derivation of the Truncation Error

Since Simpson's 3/8 rule approximates the function $f(x)$ as a quartic
through $x_0$,$x_1$,$x_2$ and $x_3$. The integral of $f(x)$ is
approximated using Taylor Series about $x$=$x_\{1.5\}$ as

$$\begin\{aligned\}
I &= \int_\{x_0\}^\{x_2\}f(x)dx = \int_\{x_0\}^\{x_2\}[f(x_\{1.5\}) + (x-x_\{1.5\})f'(x_\{1.5\}) + \dfrac\{1\}\{2\}(x-x_\{1.5\})^2f^\{(2)\}(x_\{1.5\}) \\
& + \dfrac\{1\}\{6\}(x-x_\{1.5\})^3f^\{(3)\}(x_\{1.5\}) + \dfrac\{1\}\{24\}(x-x_\{1.5\})^4f^\{(4)\}(x_\{1.5\}) + O(5)]dx
\end\{aligned\}$$

Integrating this function in a similar manner to that used for the 1/3
rule yields

$$\begin\{aligned\}
\int_\{x_0\}^\{x_2\}f(x)dx &=  \frac\{3h\}\{8\}[f(x_0) + 3f(x_1) + 3f(x_2) + f(x_3)] - \underbrace\{\frac\{3\}\{80\}h^5f^\{(4)\}(x_1)\}_\{\text\{Truncation Error\}\}
\end\{aligned\}$$


# Integration with the Trapezoidal Rule \{#chap:trapezoidal\}

------------------------------------------------------------------------

\
**Prerequisites:**
[\[chap:calculus\]](#chap:calculus)\{reference-type="ref+label"
reference="chap:calculus"\}\
**Difficulty Level:** \*\

------------------------------------------------------------------------

In this chapter we will explain how Newton-Cotes integration formulas
are based on the strategy of replacing a complicated function or
tabulated data with a polynomial that is easy to integrate. We will then
learn how to implement the single and composite application Newton-Cotes
formulas using the Trapezoidal rule.

## Introduction

Integration is one of the two main operations of calculus, with its
inverse, differentiation, being the other. In most engineering and
physical applications, the integrand $f(x)$ may be known only at certain
points, such as obtained by sampling, which calls for computing an
approximate solution to a definite integral or numerical integration. In
some other cases, a formula for the integrand may be known, but it may
be difficult or impossible to find an antiderivative that is an
elementary function. In numerical integration, the problem is to compute
an approximate solution to $$\begin\{aligned\}
I &= \int_\{a\}^\{b\} f(x) dx
\end\{aligned\}$$ to a given degree of accuracy. Integration can also be
interpreted as the total value, or summation, of $f(x) dx$ over the
range $x = a$ to $b$. The integral corresponds to the area under the
curve of $f(x)$ between $x = a$ and $b$.

::: marginfigure
![image](figures/part1b/integration_trapezoidal/integration0.png)\{width="2.4in"\}
:::

::: marginfigure
![image](figures/part1b/integration_trapezoidal/intro_0.png)\{width="2.4in"\}
:::

For example, consider a non-uniform wind blowing against the leaning
tower of Pisa given by velocity $v\mathrm\{m\}/\mathrm\{s\}$ as a function
of position. Since the velocity is location dependent, we can write
force $F$ as $$\begin\{aligned\}
F &= 0.5\rho\sum_\{i=1\}^\{n\} (\Delta A_i v_i^2)
\end\{aligned\}$$ where $n$ is the number of discrete area segments,
$\rho$ is the air density and $A$ is the surface area. For the
continuous case, where $v(x, y)$ is a known function, numerical
integration yields $$\begin\{aligned\}
F &= 0.5\rho\int\int v(x,y)^2 dA
\end\{aligned\}$$ Similarly, the percentage of charge $C$ left in your
phone is displayed by calculating the integral of instantaneous current
$I(t)$ over time given by $$\begin\{aligned\}
C = \int_\{t_1\}^\{t_2\} I(t) dt
\end\{aligned\}$$ Your monthly electricity bill is compiled based on the
total electrical energy $E$ consumed give by the numerical integral of
the instantaneous power $P(t)$ over the entire month, $$\begin\{aligned\}
E = \int_\{t_1\}^\{t_2\} P(t) dt
\end\{aligned\}$$ In the context of stocks and shares, the average value
of a share is evaluated over a period by computing the cost integral
over time and dividing by the time-period length. Approximate values for
integrals are obtained by using numerical integration techniques as
described next.

## Newton-Cotes Formulas

In this method a complicated function or tabulated data is replaced with
a polynomial that is easy to integrate:

$$\begin\{aligned\}
I = \int_\{a\}^\{b\} f(x) dx \cong \int_\{a\}^\{b\} f_n(x) dx
\end\{aligned\}$$ where $f_n(x)$ is a polynomial of the form
$$\begin\{aligned\}
f_n(x) = a_0 + a_1x + a_2x^2 + ... + a_\{n-1\}x^\{n-1\} + a_nx^n
\end\{aligned\}$$

::: marginfigure
![image](figures/part1b/integration_trapezoidal/polynomial0.png)\{width="2.4in"\}
:::

where $n$ is the order of the polynomial. For example, in Fig.
[\[fig:3\]](#fig:3)\{reference-type="ref" reference="fig:3"\}a, a
first-order polynomial (a straight line) is used as an approximation. In
Fig. [\[fig:3\]](#fig:3)\{reference-type="ref" reference="fig:3"\}b, a
parabola is employed for the same purpose. The integral can also be
approximated using a series of polynomials applied piecewise to the
function or data over segments of constant length. For example, in Fig.
[\[fig:4\]](#fig:4)\{reference-type="ref" reference="fig:4"\}, three
straight-line segments are used to approximate the integral.
Higher-order polynomials can be utilized for the same purpose.

::: marginfigure
![image](figures/part1b/integration_trapezoidal/piecewise0.png)\{width="2.4in"\}
:::

Newton-Cotes formulas include closed and open forms. The closed forms
are those where the data points at the beginning and end of the limits
of integration are known. The open forms have integration limits that
extend beyond the range of the data. In this lecture we will deal with
closed forms.

## The Trapezoidal Rule

The trapezoidal rule is the first of the Newton-Cotes closed integration
formulas. It corresponds to the case where the polynomial is
first-order: $$\begin\{aligned\}
I = \int_\{a\}^\{b\} [f(a) + \dfrac\{f(b) - f(a)\}\{b - a\}(x - a)] dx
\end\{aligned\}$$ The result of integration is called the trapezoidal
rule. $$\begin\{aligned\}
I = (b - a)\dfrac\{f(a) + f(b)\}\{2\}
\end\{aligned\}$$ Geometrically, the trapezoidal rule is equivalent to
approximating the area of the trapezoid under the straight line
connecting $f (a)$ and $f (b)$ in
Fig.[\[fig:5\]](#fig:5)\{reference-type="ref" reference="fig:5"\}. Now
area of a trapezoid is height times the average of the bases.
$$\begin\{aligned\}
I &= \mathrm\{width\} \times \mathrm\{average\ height\} \\
&= (b-a) \times \dfrac\{[f(a)+f(b)]\}\{2\}
\end\{aligned\}$$ We can convert this into Physika code directly as
follows

``` \{.python language="python"\}
def trapezoidal_rule(f: $\mathbb\{R\} \to \mathbb\{R\}$, a: $\mathbb\{R\}$, b: $\mathbb\{R\}$) $\to$ $\mathbb\{R\}$:
  (b - a) * (f(b) + f(a))/2
```

::: marginfigure
![image](figures/part1b/integration_trapezoidal/trapezoidal0.jpg)\{width="2.4in"\}
:::

### Error of the Trapezoidal Rule

When we employ the integral under a straight-line segment to approximate
the integral under a curve, we obviously can incur an error that may be
substantial. An estimate for the local truncation error of a single
application of the trapezoidal rule is

$$\begin\{aligned\}
E_t = -\dfrac\{1\}\{12\}f''(\xi)(b-a)^3
\end\{aligned\}$$ where $\xi$ lies somewhere in the interval from $a$ to
$b$. The above equation indicates that if the function being integrated
is linear, the trapezoidal rule will be exact because the second
derivative of a straight line is zero. Otherwise, for functions with
second- and higher-order derivatives, some error can occur.

### The Composite Trapezoidal Rule

One way to improve the accuracy of the trapezoidal rule is to divide the
integration interval from $a$ to $b$ into a number of segments and apply
the method to each segment (Fig.
[\[fig:6\]](#fig:6)\{reference-type="ref" reference="fig:6"\}). The areas
of individual segments can then be added to yield the integral for the
entire interval. The resulting equations are called composite, or
multiple-segment, integration formulas. There are $n + 1$ equally spaced
base points $(x_0, x_1, x_2, . . . , x_n)$. Consequently, there are $n$
segments of equal width: $$\begin\{aligned\}
h = \dfrac\{b-a\}\{n\}
\end\{aligned\}$$

::: marginfigure
![image](figures/part1b/integration_trapezoidal/composite0.jpg)\{width="2.4in"\}
:::

If $a$ and $b$ are designated as $x_0$ and $x_n$, respectively, the
total integral can be represented as $$\begin\{aligned\}
I = \int_\{x_0\}^\{x_1\} f(x) dx + \int_\{x_1\}^\{x_2\} f(x) dx + \dotsc + \int_\{x_\{n-1\}\}^\{x_n\} f(x) dx
\end\{aligned\}$$ Substituting the trapezoidal rule for each integral and
grouping yields $$\begin\{aligned\}
I &= h\dfrac\{f(x_0) + f(x_1)\}\{2\} + h\dfrac\{f(x_1) + f(x_2)\}\{2\} + ... + h\dfrac\{f(x_\{n-1\}) + f(x_n)\}\{2\}\\
&= \dfrac\{h\}\{2\}[f(x_0) + 2\sum_\{i=1\}^\{n-1\}f(x_i)+f(x_n)] \\
&= (b-a)\dfrac\{f(x_0) + 2\sum_\{i=1\}^\{n-1\}f(x_i)+f(x_n)\}\{2n\}
\end\{aligned\}$$ According to the above equation, the interior points are
given twice the weight of the two end points $f(x_0)$ and $f(x_n)$. We
can again directly convert this implementation into Physika

``` \{.python language="python"\}
def composite_trapezoidal_rule(f: $\mathbb\{R\} \to \mathbb\{R\}$, xs: $\mathbb\{R\}^n$) $\to$ $\mathbb\{R\}$:
  b = xs[n-1], a = xs[0]
  (b-a)*(f(xs[0]) + 2*sum(
    [f(xs[i]) for i in range(1,n)]) + f(xs[n-1]))/(2*n)
```

An error for the composite trapezoidal rule can be obtained by summing
the individual errors for each segment to give $$\begin\{aligned\}
E_t = -\dfrac\{(b-a)^3\}\{12n^3\}\sum_\{i=1\}^\{n\}f''(\xi_i)
\end\{aligned\}$$ where $f''(\xi_i)$ is the second derivative at a point
$\xi_i$ located in segment $i$. This result can be simplified by
estimating the mean or average value of the second derivative for the
entire interval as $$\begin\{aligned\}
\bar\{f''\} \cong \dfrac\{\sum_\{i=1\}^\{n\}f''(\xi_i)\}\{n\}
\end\{aligned\}$$ Therefore $\sum f''(\xi_i) = \cong n\bar\{f''\}$ and hence
we have $$\begin\{aligned\}
E_a = -\dfrac\{(b-a)^3\}\{12n^2\}\bar\{f''\}
\end\{aligned\}$$ Therefore the error decreases as the number of segments
increases. However, the rate of decrease is gradual because the error is
inversely related to the square of $n$. Therefore, doubling the number
of segments quarters the error. Note that above equation is an
approximate error.
