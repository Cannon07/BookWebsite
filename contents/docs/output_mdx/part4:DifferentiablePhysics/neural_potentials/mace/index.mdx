# MACE \{#chap:allegro\}

------------------------------------------------------------------------

\
**Prerequisites:** [\[chap:dft\]](#chap:dft)\{reference-type="ref+label"
reference="chap:dft"\}\
**Difficulty Level:** \*\*\

------------------------------------------------------------------------

In this chapter, we learn about higher order equivariant message passing
neural networks that pass more than two body messages.

## A Brief Review of Message Passing

The state of node $i$ in layer $t$ of the MPNN is given by

$$\begin\{aligned\}
\sigma_i^\{(t)\} &= (r_i, z_i, h_i^\{(t)\})
\end\{aligned\}$$

The energy is given by $$\begin\{aligned\}
E_i &= \sum_\{t=1\}^T \mathcal\{R\}_t(\sigma_i^\{(t)\})
\end\{aligned\}$$

ACE introduced higher order local descriptors. Multi-ACE is an extension
of ACE using equivariant MPNNs.

## The MACE Architecture

Expand the messages using a hierarchical body ordered expansion

$$\begin\{aligned\}
m_i^\{(t)\} &= \sum_j u_1(\sigma_i^\{(t)\}, \sigma_j^\{(t)\}) +  \sum_\{j_1, j_2\}^\{(t)\} u_2(\sigma_i^\{(t)\}, \sigma_\{j_1\}^\{(t)\}, \sigma_\{j_2\}^\{(t)\})
\end\{aligned\}$$ Note that self-interactions are allowed in this
expansion. The $A$ is constructed in a fashion similar to ACE. $B$ terms
are constructed from $A$ terms by forming tensor products of the
features and then symmetrizing , also as done in the ACE archithecture.
